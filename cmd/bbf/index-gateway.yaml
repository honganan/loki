target: index-gateway
auth_enabled: false

server:
  graceful_shutdown_timeout: 5s
  grpc_server_max_concurrent_streams: 0
  grpc_server_max_recv_msg_size: 100000000
  grpc_server_max_send_msg_size: 100000000
  http_listen_port: 3103
  grpc_listen_port: 9092

ingester:
  lifecycler:
    ring:
      kvstore:
        store: consul
        consul:
          host: localhost:8500
          acl_token: 4f9b7fec-ae6d-9923-cf12-a7fe9cd0ba47
          http_client_timeout: 20s
          consistent_reads: true
      replication_factor: 1
    final_sleep: 0s
  chunk_idle_period: 1m #在没有更新之前chunk在内存中的时间
  chunk_retain_period: 30s  #刷新后应在内存中保留多长时间
  max_chunk_age: 2h
  chunk_block_size: 262144     # 256KB
  chunk_target_size: 1572864   # 1.5MB
  chunk_encoding: lz4
  query_store_max_look_back_period: 0s
  wal:
    enabled: false

storage_config:
  tsdb_shipper:
    active_index_directory: /Users/honganan/loki/tsdb-index
    cache_location: /Users/honganan/loki/tsdb-cache
    cache_ttl: 24h
    query_ready_num_days: 2
    index_gateway_client:
      server_address: localhost:9092
  aws:
    s3: s3://<ak>:<sk>@<region>/<bucket>
    s3forcepathstyle: true
    insecure: true
    http_config:
      response_header_timeout: 1000ms
      insecure_skip_verify: true
  max_parallel_get_chunk: 100
  max_chunk_batch_size: 100
  index_cache_validity: 1m

index_gateway:
  mode: simple

compactor:
  working_directory: /Users/honganan/loki/boltdb-shipper-compactor


schema_config:
  configs:
    - from: 2024-10-01
      store: tsdb
      object_store: s3
      schema: v12
      index:
        prefix: tsdb_index_
        period: 24h
      bbf_shards: 10
      bbf_streams:
        - selector: '{application=~"testapp1|testapp2"}'

bbf_config:
  query_enabled: true
  path: /Users/honganan/loki/bbf-index
  wal_path: /Users/honganan/loki/bbf-index-wal
  flush_interval: 5m
  retention: 168h
  gc_interval: 1h
  refresh_interval: 10m
  compute_parallelism: 2
  write_parallelism: 2
  shard_capacity: 1000000
  cache:
    embedded_cache:
      enabled: true
      max_size_mb: 300
      ttl: 1h
  ring:
    kvstore:
      store: consul
      consul:
        host: localhost:8500
        acl_token: 4f9b7fec-ae6d-9923-cf12-a7fe9cd0ba47
        http_client_timeout: 20s
        consistent_reads: true
    replication_factor: 1

querier:
  max_concurrent: 4
  query_store_only: false
  query_ingesters_within: 1h

limits_config:
  per_stream_rate_limit: 500MB
  ingestion_burst_size_mb: 100
  ingestion_rate_mb: 100
  ingestion_rate_strategy: local
  max_global_streams_per_user: 10000
  max_entries_limit_per_query: 50000
  max_query_length: 168h
  max_query_parallelism: 160
  tsdb_max_query_parallelism: 8
  max_streams_per_user: 0
  max_query_series: 5000000
  reject_old_samples: false
  reject_old_samples_max_age: 168h
  cardinality_limit: 200000
  split_queries_by_interval: 10m
  allow_structured_metadata: false
  tsdb_precompute_chunks: false

analytics:
  reporting_enabled: false
