target: querier
auth_enabled: false

server:
  graceful_shutdown_timeout: 5s
  grpc_server_max_concurrent_streams: 0
  grpc_server_max_recv_msg_size: 100000000
  grpc_server_max_send_msg_size: 100000000
  http_listen_port: 3109
  grpc_listen_port: 9099

common:
  compactor_grpc_address: "localhost:9090"

ingester:
  lifecycler:
    ring:
      kvstore:
        store: consul
        consul:
          host: localhost:8500
          acl_token: 4f9b7fec-ae6d-9923-cf12-a7fe9cd0ba47
          http_client_timeout: 20s
          consistent_reads: true
      replication_factor: 1
    final_sleep: 0s
  chunk_idle_period: 1m #在没有更新之前chunk在内存中的时间
  chunk_retain_period: 30s  #刷新后应在内存中保留多长时间
  max_chunk_age: 2h
  chunk_block_size: 262144     # 256KB
  chunk_target_size: 1572864   # 1.5MB
  chunk_encoding: lz4
  query_store_max_look_back_period: 0s
  wal:
    enabled: false

storage_config:
  tsdb_shipper:
    active_index_directory: /Users/honganan/loki/tsdb-index
    cache_location: /Users/honganan/loki/tsdb-cache
    cache_ttl: 24h
    query_ready_num_days: 2
    index_gateway_client:
      server_address: localhost:9092
  aws:
    s3: s3://<ak>:<sk>@<region>/<bucket>
    s3forcepathstyle: true
    insecure: true
    http_config:
      response_header_timeout: 1000ms
      insecure_skip_verify: true
  max_parallel_get_chunk: 100
  max_chunk_batch_size: 100
  index_cache_validity: 1m

index_gateway:
  mode: simple

compactor:
  working_directory: /Users/honganan/loki/boltdb-shipper-compactor

schema_config:
  configs:
    - from: 2023-02-22
      store: tsdb
      object_store: s3
      schema: v12
      index:
        prefix: tsdb_index_
        period: 24h

bbf_config:
  query_enabled: true
  ring:
    kvstore:
      store: consul
      consul:
        host: localhost:8500
        acl_token: 4f9b7fec-ae6d-9923-cf12-a7fe9cd0ba47
        http_client_timeout: 20s
        consistent_reads: true
    replication_factor: 1
#  final_sleep: 0s

limits_config:
  per_stream_rate_limit: 500MB
  ingestion_burst_size_mb: 100
  ingestion_rate_mb: 100
  ingestion_rate_strategy: local
  max_global_streams_per_user: 10000
  max_entries_limit_per_query: 50000
  max_query_length: 168h
  max_query_parallelism: 160
  tsdb_max_query_parallelism: 8
  max_streams_per_user: 0
  max_query_series: 5000000
  reject_old_samples: false
  reject_old_samples_max_age: 168h
  cardinality_limit: 200000
  split_queries_by_interval: 10m
  allow_structured_metadata: false
  tsdb_sharding_strategy: bounded
  tsdb_precompute_chunks: false

query_range:
  align_queries_with_step: true
  cache_results: false
  max_retries: 2

querier:
  max_concurrent: 8
  query_store_only: false
  query_ingesters_within: 2h

frontend_worker:
#  frontend_address: 127.0.0.1:9099
  scheduler_address: 127.0.0.1:9090
frontend:
  max_outstanding_per_tenant: 32768
  scheduler_worker_concurrency: 60

query_scheduler:
  max_outstanding_requests_per_tenant: 32768

analytics:
  reporting_enabled: false
